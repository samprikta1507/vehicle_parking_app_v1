{% extends "user_layout.html" %}
{% block content %}
                <!-- Recent Parking History -->
              <div class="container mt-4">
                <div class="box">
                  <div class="section-title">Recent parking history</div>
                  <table class="table table-bordered text-center">
                    <thead class="table-light">
                      <tr>
                        <th>ID</th>
                        <th>Location</th>
                        <th>Spot No</th>
                        <th>Actual Start</th>
                        <th>Actual End</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for r in active_reservations %}
                        <tr>
                          <td>{{ r.id }}</td>
                          <td>{{ r.parking_lot.address }}</td>
                          <td>{{ r.parking_spot.id }}</td>
                          <td>
                            {% if r.park_time %}
                              {{ r.park_time.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                              -
                            {% endif %}
                          </td>
                          <td>
                            {% if r.release_time %}
                              {{ r.release_time.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                              -
                            {% endif %}
                          </td>
                          <td>
                            {% if not r.park_time %}
                              <!-- Show Start Parking -->
                              <form method="POST" action="{{ url_for('start_parking', reservation_id=r.id, name=name) }}" class="d-inline">
                                <button type="submit" class="btn btn-outline-primary btn-sm">Start Parking</button>
                              </form>
                            {% elif not r.release_time %}
                              <!-- Show Release -->
                              <form method="POST" action="{{ url_for('release_reservation', reservation_id=r.id, name=name) }}" class="d-inline">
                                <button type="submit" class="btn btn-outline-danger btn-sm">Release</button>
                              </form>
                            {% else %}
                              <button class="btn btn-outline-success btn-sm" disabled>Ended</button>
                            {% endif %}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>

                <!-- Search -->
                <div class="mb-3 text-danger fw-bold">
                  <form method="GET" class="mb-4" action="{{ url_for('user_dashboard_search', name=name) }}">
                    <label for="location" class="fw-bold">Search parking by location/pin:</label>
                    <input type="text" name="location" value="{{ request.args.get('location', '') }}" class="form-control d-inline w-50 mx-2" required>
                    <button type="submit" class="btn btn-primary">Search</button>
                    <a href="{{ url_for('user_dashboard', name=name) }}" class="btn btn-secondary">Clear</a>
                  </form>
                </div>


                <!-- Available Parking Lots -->
                <div class="box">
                  <div class="section-title">Parking Lots</div>
                  <table class="table table-bordered text-center">
                    <thead class="table-light">
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Availability</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for lot in available_data %}
                        <tr>
                          <td>{{ lot.id }}</td>
                          <td>{{ lot.name }}</td>
                          <td>{{ lot.address }}</td>
                          <td>{{ lot.available_spots }}/{{ lot.total_spots }}</td>
                          <td>
                            {% if lot.available_spots > 0 %}
                              <form method="POST" action="{{ url_for('book_spot', lot_id=lot.id, name=name) }}">
                                <div class="row">
                                  <div class="col">
                                    <input type="datetime-local" name="start_time" value="{{ now.strftime('%Y-%m-%dT%H:%M') }}" min="{{ now.strftime('%Y-%m-%dT%H:%M') }}" required class="form-control">
                                  </div>
                                  <div class="col">
                                    <select name="duration" required class="form-control">
                                      <option value="1">1 hour</option>
                                      <option value="2">2 hours</option>
                                      <option value="3">3 hours</option>
                                      <option value="4">4 hours</option>
                                    </select>
                                  </div>
                                  <div class="col">
                                    <button type="submit" class="btn btn-outline-primary btn-sm">Book</button>
                                  </div>
                                </div>
                              </form>
                          {% else %}
                            <button class="btn btn-outline-secondary" disabled>Full</button>
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
{% endblock %}

<!--# done the auth today too-->